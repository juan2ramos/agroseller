@extends('layoutBack')

@section('content')
    <section class="BackContainer row" style="position: relative;">
        <article class="QuestionList small-12">
            <h2>Ultimas preguntas</h2>
            <section class="QuestionList-questions">
                <input id="questionDetail" type="hidden" value="{{route('questions')}}">

                @foreach($questions as $question)
                    <article class="QuestionList-item row middle">
                      @if($question->isResponded)
                        <figure class="stateIcon isResponded">
                      @else
                        <figure class="stateIcon">
                      @endif
                            <svg viewBox="0 0 32 32" class="svgIcon detailsTitle-checkmarkSvg">
                                <polygon points="30,5.077 26,2 11.5,22.5 4.5,15.5 1,19 12,30"></polygon>
                            </svg>
                        </figure>
                        <span class="ProductName">{{$question->product->name}}</span>
                        <input class="ClientName" type="hidden" value="{{$question->user->name}}">
                        <input class="QuestionId" type="hidden" value="{{$question->id}}">
                    </article>
                @endforeach
            </section>
        </article>
        <article class="Question small-6 column">
            <div class="QuestionUser">
                <div class="QuestionHead row between">
                    <div class="Identity">
                        <figure class="Identity-avatar">
                            <img src="/images/user.png" alt="avatar">
                        </figure>
                        <span id="IdentityHeaderName">Nombre cliente</span>
                    </div>
                    <div class="QuestionHead-date">
                        <div class="QuestionHead-date-icon">
                            <svg width="23px" height="23px" viewBox="0 0 28 28" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                                <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                                    <g id="Product-detail" transform="translate(-710.000000, -437.000000)" fill="#B9BCC0">
                                        <path d="M723.735318,438.12 C724.816118,438.12 725.892065,438.26 726.934785,438.53552 C728.009612,438.82 729.048225,439.24896 730.022252,439.810453 C731.495052,440.660533 732.758038,441.77456 733.774625,443.119307 C734.756118,444.418507 735.469185,445.879733 735.892172,447.4608 C736.314785,449.041493 736.428652,450.663253 736.227425,452.280533 C736.020225,453.953067 735.483745,455.548693 734.632172,457.022987 C734.060225,458.01456 733.360225,458.918773 732.552332,459.7136 C731.769452,460.483787 730.886892,461.148693 729.928918,461.689653 C728.034625,462.76 725.883478,463.325973 723.707692,463.325973 C722.626892,463.325973 721.549452,463.185973 720.508225,462.910453 C719.433398,462.625973 718.393665,462.197013 717.420758,461.6344 C715.947958,460.783947 714.684972,459.66992 713.668385,458.325173 C712.686892,457.025973 711.973825,455.564747 711.549718,453.98368 C711.128225,452.402987 711.014358,450.781227 711.215585,449.16544 C711.422785,447.492907 711.959265,445.895787 712.810838,444.422987 C713.382785,443.432907 714.082785,442.5272 714.890678,441.732373 C715.673558,440.962187 716.556118,440.29728 717.514092,439.75632 C719.408385,438.685973 721.559532,438.12 723.735318,438.12 L723.735318,438.12 Z M723.735318,437 C718.994358,437.001493 714.381452,439.46176 711.839798,443.862987 C708.052332,450.42544 710.299798,458.816853 716.862252,462.60544 C719.023478,463.852373 721.381452,464.445973 723.709185,464.445973 C728.451638,464.445973 733.063052,461.985707 735.603212,457.582987 C739.392172,451.020533 737.143212,442.62912 730.580758,438.840533 C728.421025,437.5936 726.063052,437 723.735318,437 L723.735318,437 Z M711.107692,450.302987 C711.358572,450.302987 712.507692,450.491147 712.507692,450.722987 C712.507692,450.954827 711.880492,451.142987 711.107692,451.142987 L711.107692,450.302987 Z M724.155318,463.337547 C724.155318,462.563253 723.967158,461.936053 723.735318,461.936053 C723.503478,461.936053 723.315318,462.563253 723.315318,463.337547 L724.155318,463.337547 Z M713.000492,457.42544 C713.669878,457.03904 714.118998,456.562293 714.004012,456.361067 C713.887158,456.159467 712.797772,456.572373 712.580492,456.697813 L713.000492,457.42544 Z M717.801558,461.906933 C718.187958,461.236053 718.338038,460.598773 718.138305,460.482293 C717.937078,460.36544 717.198998,461.26816 717.075052,461.48544 L717.801558,461.906933 Z M736.336812,450.330613 C736.085932,450.330613 734.936812,450.518773 734.936812,450.750613 C734.936812,450.982453 735.564012,451.170613 736.336812,451.170613 L736.336812,450.330613 Z M734.864012,456.641067 C734.646732,456.515627 733.557345,456.10272 733.441985,456.303947 C733.326998,456.505173 733.774625,456.982293 734.444012,457.368693 L734.864012,456.641067 Z M730.398572,461.459307 C730.273132,461.242027 729.535052,460.339307 729.335318,460.455787 C729.134092,460.57264 729.284172,461.20992 729.672438,461.8808 L730.398572,461.459307 Z M723.315318,438.108427 C723.315318,438.88272 723.503478,439.50992 723.735318,439.50992 C723.967158,439.50992 724.155318,438.88272 724.155318,438.108427 L723.315318,438.108427 Z M712.580492,444.77728 C712.797772,444.90272 713.887158,445.315627 714.004012,445.1144 C714.118998,444.913173 713.671372,444.436053 713.000492,444.049653 L712.580492,444.77728 Z M717.045932,439.986667 C717.171372,440.203947 717.909452,441.106667 718.109185,440.990187 C718.310412,440.873333 718.160332,440.236053 717.772065,439.565173 L717.045932,439.986667 Z M734.444012,444.07728 C733.774625,444.46368 733.325505,444.9408 733.441985,445.142027 C733.557345,445.343253 734.648225,444.930347 734.864012,444.804907 L734.444012,444.07728 Z M729.700065,439.594293 C729.313665,440.265173 729.163212,440.902453 729.362945,441.019307 C729.564172,441.135787 730.302252,440.233067 730.426198,440.015787 L729.700065,439.594293 Z M723.162252,450.23728 L723.162252,442.407733 C723.162252,442.216587 723.367958,441.482987 723.620332,441.482987 L723.824172,441.482987 C724.076545,441.482987 724.282252,442.216587 724.282252,442.407733 L724.282252,449.591413 L723.162252,450.23728 Z M722.959532,450.355627 C722.853132,450.416853 722.895318,450.687893 723.052865,450.962293 L723.181292,451.182187 C723.338838,451.456587 723.553132,451.628693 723.661025,451.567467 L728.409452,448.825707 C728.515852,448.76448 728.797345,448.3064 728.638305,448.032373 L728.509878,447.812107 C728.352332,447.53808 727.815852,447.55264 727.707958,447.613867 L722.959532,450.355627 Z" id="Page-1"></path>
                                    </g>
                                </g>
                            </svg>
                        </div>
                        <span id="QuestionHeader"></span>
                    </div>
                    <span class="QuestionHead-close">x</span>
                </div>
                <section class="QuestionContent row">
                    <article class="QuestionContent-title row middle small-12">
                        <figure class="stateIcon active">
                            <svg title="checkmark" viewBox="0 0 32 32" class="svgIcon detailsTitle-checkmarkSvg">
                                <polygon points="30,5.077 26,2 11.5,22.5 4.5,15.5 1,19 12,30"></polygon>
                            </svg>
                        </figure>
                        <h2 id="ProductName">Nombre del producto</h2>
                    </article>
                    <article id="QuestionContentText" class="small-12">Texto de la pregunta</article>
                    <section class="QuestionContent-Answers" id="Answers"></section>
                </section>
            </div>
            <section class="AnswerQuestion">
                <form action="" class="row">
                    <input id="QuestionId" type="hidden">
                    <input id="token" type="hidden" name="_token" value="{{ csrf_token() }}">
                    <div class="answerBox">
                        <textarea name="answer" id="answerBoxBack"></textarea>
                        <button class="answerButton" id="answerButtonBack" onclick="return false">Enviar</button>
                    </div>
                </form>
            </section>
        </article>
    </section>
    <button></button>
@endsection

@section('scripts')
    <script>
        $('.QuestionHead-close').on('click', function(){
            $('.QuestionList').addClass('small-12').removeClass('small-6');
        });

        $('.QuestionList-item').on('click', function() {
            $('.Question').show();
            $('.QuestionList').removeClass('small-12').addClass('small-6');
            $(this).siblings().children().removeClass('active');
            $(this).children().addClass('active');

            var productName = $(this).children('.ProductName').text();
            var param = {
                '_token'  : $('#token').val(),
                'question_id': $(this).children('.QuestionId').val()
            };

            $('#QuestionId').val(param.question_id);

            $.ajax({
                url     :  "{{route('questionDetail')}}",
                type    :  'post',
                dataType:  'json',
                data    :   param,
                success :   function (data) {
                    $('#QuestionHeader').text(data.text[0].date);
                    $('#IdentityHeaderName').text(data.text[0].user.name);
                    $('#ProductName').text(productName);
                    $('#QuestionContentText').html('<p>'+ data.text[0].description +'</p>');
                    $('#Answers').empty();
                    reloadQuestion(data);
                    if(data.text[0].question.isResponded == 1) $('.stateIcon.active').addClass('isResponded');
                    else $('.stateIcon.active').removeClass('isResponded');
                },
                error   :   function() {
                    alert('error');
                }
            });
        });

        $('#answerButtonBack').on('click', function(){
            var param = {
                '_token'      : $('#token').val(),
                'question_id' : $('#QuestionId').val(),
                'description' : $('#answerBoxBack').val()
            };
            if($('#answerBoxBack').val() != ''){
                $.ajax({
                    url     :  "{{route('questionNew')}}",
                    type    :  'post',
                    dataType:  'json',
                    data    :   param,
                    success :   function (data) {
                        $('#Answers').empty();
                        reloadQuestion(data);
                        if(data.text[0].question.isResponded == 1) $('.stateIcon.active').addClass('isResponded');
                    }
                });
            }
            $('#answerBoxBack').val('');
        });

        function reloadQuestion(data){
            if(data.text.length > 0){
                for(var i = 1; i < data.text.length; i++){
                    var html = '';
                    html += '<article class="QuestionContent-AnswersItem">' +
                                '<div class="QuestionHead row">' +
                                    '<div class="Identity small-6">' +
                                        '<figure class="Identity-avatar">' +
                                            '<img src="/images/user.png">' +
                                        '</figure>' +
                                    '<span class="Identity-name">' + data.text[i].user.name + '</span>' +
                                '</div>' +
                                '<div class="QuestionHead-date small-6">' +
                                    '<div class="QuestionHead-date-icon">' +
                                        '<svg width="23px" height="23px" viewBox="0 0 28 28" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">' +
                                            '<g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">' +
                                                '<g id="Product-detail" transform="translate(-710.000000, -437.000000)" fill="#B9BCC0">' +
                                                    '<path d="M723.735318,438.12 C724.816118,438.12 725.892065,438.26 726.934785,438.53552 C728.009612,438.82 729.048225,439.24896 730.022252,439.810453 C731.495052,440.660533 732.758038,441.77456 733.774625,443.119307 C734.756118,444.418507 735.469185,445.879733 735.892172,447.4608 C736.314785,449.041493 736.428652,450.663253 736.227425,452.280533 C736.020225,453.953067 735.483745,455.548693 734.632172,457.022987 C734.060225,458.01456 733.360225,458.918773 732.552332,459.7136 C731.769452,460.483787 730.886892,461.148693 729.928918,461.689653 C728.034625,462.76 725.883478,463.325973 723.707692,463.325973 C722.626892,463.325973 721.549452,463.185973 720.508225,462.910453 C719.433398,462.625973 718.393665,462.197013 717.420758,461.6344 C715.947958,460.783947 714.684972,459.66992 713.668385,458.325173 C712.686892,457.025973 711.973825,455.564747 711.549718,453.98368 C711.128225,452.402987 711.014358,450.781227 711.215585,449.16544 C711.422785,447.492907 711.959265,445.895787 712.810838,444.422987 C713.382785,443.432907 714.082785,442.5272 714.890678,441.732373 C715.673558,440.962187 716.556118,440.29728 717.514092,439.75632 C719.408385,438.685973 721.559532,438.12 723.735318,438.12 L723.735318,438.12 Z M723.735318,437 C718.994358,437.001493 714.381452,439.46176 711.839798,443.862987 C708.052332,450.42544 710.299798,458.816853 716.862252,462.60544 C719.023478,463.852373 721.381452,464.445973 723.709185,464.445973 C728.451638,464.445973 733.063052,461.985707 735.603212,457.582987 C739.392172,451.020533 737.143212,442.62912 730.580758,438.840533 C728.421025,437.5936 726.063052,437 723.735318,437 L723.735318,437 Z M711.107692,450.302987 C711.358572,450.302987 712.507692,450.491147 712.507692,450.722987 C712.507692,450.954827 711.880492,451.142987 711.107692,451.142987 L711.107692,450.302987 Z M724.155318,463.337547 C724.155318,462.563253 723.967158,461.936053 723.735318,461.936053 C723.503478,461.936053 723.315318,462.563253 723.315318,463.337547 L724.155318,463.337547 Z M713.000492,457.42544 C713.669878,457.03904 714.118998,456.562293 714.004012,456.361067 C713.887158,456.159467 712.797772,456.572373 712.580492,456.697813 L713.000492,457.42544 Z M717.801558,461.906933 C718.187958,461.236053 718.338038,460.598773 718.138305,460.482293 C717.937078,460.36544 717.198998,461.26816 717.075052,461.48544 L717.801558,461.906933 Z M736.336812,450.330613 C736.085932,450.330613 734.936812,450.518773 734.936812,450.750613 C734.936812,450.982453 735.564012,451.170613 736.336812,451.170613 L736.336812,450.330613 Z M734.864012,456.641067 C734.646732,456.515627 733.557345,456.10272 733.441985,456.303947 C733.326998,456.505173 733.774625,456.982293 734.444012,457.368693 L734.864012,456.641067 Z M730.398572,461.459307 C730.273132,461.242027 729.535052,460.339307 729.335318,460.455787 C729.134092,460.57264 729.284172,461.20992 729.672438,461.8808 L730.398572,461.459307 Z M723.315318,438.108427 C723.315318,438.88272 723.503478,439.50992 723.735318,439.50992 C723.967158,439.50992 724.155318,438.88272 724.155318,438.108427 L723.315318,438.108427 Z M712.580492,444.77728 C712.797772,444.90272 713.887158,445.315627 714.004012,445.1144 C714.118998,444.913173 713.671372,444.436053 713.000492,444.049653 L712.580492,444.77728 Z M717.045932,439.986667 C717.171372,440.203947 717.909452,441.106667 718.109185,440.990187 C718.310412,440.873333 718.160332,440.236053 717.772065,439.565173 L717.045932,439.986667 Z M734.444012,444.07728 C733.774625,444.46368 733.325505,444.9408 733.441985,445.142027 C733.557345,445.343253 734.648225,444.930347 734.864012,444.804907 L734.444012,444.07728 Z M729.700065,439.594293 C729.313665,440.265173 729.163212,440.902453 729.362945,441.019307 C729.564172,441.135787 730.302252,440.233067 730.426198,440.015787 L729.700065,439.594293 Z M723.162252,450.23728 L723.162252,442.407733 C723.162252,442.216587 723.367958,441.482987 723.620332,441.482987 L723.824172,441.482987 C724.076545,441.482987 724.282252,442.216587 724.282252,442.407733 L724.282252,449.591413 L723.162252,450.23728 Z M722.959532,450.355627 C722.853132,450.416853 722.895318,450.687893 723.052865,450.962293 L723.181292,451.182187 C723.338838,451.456587 723.553132,451.628693 723.661025,451.567467 L728.409452,448.825707 C728.515852,448.76448 728.797345,448.3064 728.638305,448.032373 L728.509878,447.812107 C728.352332,447.53808 727.815852,447.55264 727.707958,447.613867 L722.959532,450.355627 Z" id="Page-1"></path>' +
                                                '</g>' +
                                            '</g>' +
                                        '</svg>' +
                                    '</div>' +
                                    '<span class="QuestionHead-date-text">' + data.text[i].date + '</span>' +
                                '</div>' +
                            '</div>' +
                            '<span class="text">' +
                                '<p>' + data.text[i].description + '</p>' +
                            '</span>' +
                        '</article>';

                    $('#Answers').append(html);
                }
            }
        }

    </script>
@endsection